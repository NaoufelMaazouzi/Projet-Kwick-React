(this.webpackJsonpprojet=this.webpackJsonpprojet||[]).push([[0],{103:function(e,t,a){},125:function(e,t,a){},128:function(e,t,a){"use strict";a.r(t);var n=a(2),s=a(0),r=a(10),c=a.n(r),i=a(22),o=a(11),l=a.n(o),u=a(21),j=(a(103),a(12)),d=a(20),h=a(24),b=a.n(h);var m=function(e){var t=e.token,a=e.id,s=Object(j.g)(),r=function(){var e=Object(u.a)(l.a.mark((function e(){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,b.a.get("".concat("https://greenvelvet.alwaysdata.net/kwick/api/","logout/").concat(t,"/").concat(a)).then((function(e){if("failure"===e.data.result.status)throw new Error;localStorage.clear(),s.go(0)})).catch((function(e){}));case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return Object(n.jsx)("div",{children:Object(n.jsx)("header",{children:Object(n.jsx)("nav",{className:"navMenu",children:Object(n.jsx)("ul",{className:"navLinks",children:t?Object(n.jsxs)(n.Fragment,{children:[Object(n.jsx)(d.b,{to:"/",className:"Link",children:Object(n.jsx)("li",{id:"messages",children:"Messages"})}),Object(n.jsx)(d.b,{to:"/login",onClick:r,className:"Link",children:"Se d\xe9connecter"})]}):Object(n.jsxs)(n.Fragment,{children:[Object(n.jsx)(d.b,{to:"/signup",className:"Link",children:Object(n.jsx)("li",{children:"S'inscrire"})}),Object(n.jsx)(d.b,{to:"/login",className:"Link",children:Object(n.jsx)("li",{children:"Se connecter"})})]})})})})})},p=a(36),O=a(61);var v=function(e){var t=e.component,a=Object(O.a)(e,["component"]);return Object(n.jsx)(j.b,Object(p.a)(Object(p.a)({},a),{},{render:function(e){return Object(n.jsx)(t,Object(p.a)({},e))}}))},x=(a(53),a(125),a(167)),g=a(180),f=a(6),w=a(181),k=a(168),N=a(175),S=Object(f.a)((function(e){return{badge:{backgroundColor:"#44b700",color:"#44b700",boxShadow:"0 0 0 2px ".concat(e.palette.background.paper),"&::after":{position:"absolute",top:0,left:0,width:"100%",height:"100%",borderRadius:"50%",animation:"$ripple 1.2s infinite ease-in-out",border:"1px solid currentColor",content:'""'}},"@keyframes ripple":{"0%":{transform:"scale(.8)",opacity:1},"100%":{transform:"scale(2.4)",opacity:0}}}}))(x.a);var y=function(e){var t=e.token,a=e.setMessages,r=e.scrollToBottom,c=Object(s.useState)([]),o=Object(i.a)(c,2),j=o[0],d=o[1],h=Object(s.useState)(0),m=Object(i.a)(h,2),p=m[0],O=m[1];Object(s.useEffect)((function(){function e(){return(e=Object(u.a)(l.a.mark((function e(){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,b.a.get("".concat("https://greenvelvet.alwaysdata.net/kwick/api/","user/logged/").concat(t)).then((function(e){if("failure"===e.data.result.status)throw new Error;d(e.data.result.user)})).catch((function(e){}));case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}!function(){e.apply(this,arguments)}()}),[t]);var v=function(){var e=Object(u.a)(l.a.mark((function e(n){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return O(n.target.value),e.next=3,b.a.get("".concat("https://greenvelvet.alwaysdata.net/kwick/api/","talk/list/").concat(t,"/").concat(0===n.target.value?0:Math.round(+new Date/1e3-n.target.value))).then((function(e){if("failure"===e.data.result.status)throw new Error;a(e.data.result.talk),r()})).catch((function(e){}));case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return Object(n.jsx)("aside",{children:Object(n.jsxs)("section",{children:[Object(n.jsx)("h4",{children:"Personnes connect\xe9es"}),Object(n.jsxs)("ul",{className:"connectesList",children:[Object(n.jsx)("div",{className:j&&j.length>7?"scrollDiv":null,children:j&&j.map((function(e,t){return Object(n.jsxs)("li",{className:"userBadge",children:[Object(n.jsx)("div",{children:Object(n.jsx)(S,{overlap:"circle",anchorOrigin:{vertical:"bottom",horizontal:"right"},variant:"dot",children:Object(n.jsx)(g.a,{alt:"Avatar",children:null!==e&&e.substring(0,1)})})}),Object(n.jsx)("div",{className:"divTextPuce",children:Object(n.jsx)("p",{className:"textPuce",children:e})})]},e)}))}),Object(n.jsxs)("div",{className:"selectMessages",children:[Object(n.jsx)("h4",{children:"Quels messages afficher ?"}),Object(n.jsx)(k.a,{children:Object(n.jsxs)(N.a,{labelId:"demo-simple-select-label",id:"demo-simple-select",value:p,onChange:v,children:[Object(n.jsx)(w.a,{value:60,children:"Derni\xe8res 10min"}),Object(n.jsx)(w.a,{value:43200,children:"Derni\xe8res 12h"}),Object(n.jsx)(w.a,{value:86400,children:"Derni\xe8res 24h"}),Object(n.jsx)(w.a,{value:172800,children:"Derni\xe8res 48h"}),Object(n.jsx)(w.a,{value:0,children:"Afficher tout"})]})})]})]})]})})};var C=function(e){var t=e.message;return Object(n.jsx)(n.Fragment,{children:t&&Object(n.jsxs)("div",{className:"divMessages",children:[Object(n.jsxs)("div",{className:"myMessagesContainer",children:[Object(n.jsx)("div",{className:"myMessages",children:Object(n.jsx)("p",{className:"contentMessage",children:t.content})}),Object(n.jsxs)("p",{className:"date",children:[new Date(1e3*t.timestamp).toLocaleDateString("fr-FR")," \xe0 ",new Date(1e3*t.timestamp).toLocaleTimeString("fr-FR")]})]}),Object(n.jsx)("div",{className:"dateContainer",children:Object(n.jsxs)("div",{children:[Object(n.jsx)(g.a,{alt:"Avatar",children:t.user_name.substring(0,1)}),Object(n.jsx)("p",{className:"userName",children:t.user_name})]})})]})})};var M=function(e){var t=e.message;return Object(n.jsx)(n.Fragment,{children:t&&Object(n.jsxs)("div",{className:"divMessages",children:[Object(n.jsxs)("div",{className:"divAvatar",children:[Object(n.jsx)("div",{className:"divAlignAvatar",children:Object(n.jsx)(g.a,{alt:"Avatar",children:t.user_name.substring(0,1)})}),Object(n.jsx)("p",{className:"userName",children:t.user_name})]}),Object(n.jsx)("div",{className:"messageBubble",children:Object(n.jsx)("p",{className:"contentMessage",children:t.content})}),Object(n.jsxs)("p",{className:"dateFromPeople",children:[new Date(1e3*t.timestamp).toLocaleDateString("fr-FR")," \xe0 ",new Date(1e3*t.timestamp).toLocaleTimeString("fr-FR")]})]})})},A=a(84),B=a(174),I=a(178),D=a(173),F=a(171),L=a(172),E=a(170);var T=function(e){var t=e.open,a=e.setOpen,s=Object(j.g)(),r=function(){a(!1),localStorage.clear(),s.go(0),s.push("/login")};return Object(n.jsxs)(I.a,{open:t,onClose:r,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",children:[Object(n.jsx)(E.a,{id:"alert-dialog-title",children:"Vous \xeates d\xe9conn\xe9ct\xe9"}),Object(n.jsx)(F.a,{children:Object(n.jsx)(L.a,{id:"alert-dialog-description",children:"Vous avez \xe9t\xe9 d\xe9connect\xe9 d\xfb \xe0 votre innactivit\xe9 de plus de 20 minutes"})}),Object(n.jsx)(D.a,{children:Object(n.jsx)(B.a,{onClick:r,color:"primary",children:"Se reconnecter"})})]})},V=a(85),P=a(88),R=a(41);var J=function(e){var t=e.token,a=e.id,s=e.fetchData,r=Object(R.a)({initialValues:{message:""},onSubmit:function(){var e=Object(u.a)(l.a.mark((function e(n){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(n.message.length>140)){e.next=3;break}return console.log("ok"),e.abrupt("return");case 3:return e.next=5,b.a.get("".concat("https://greenvelvet.alwaysdata.net/kwick/api/","say/").concat(t,"/").concat(a,"/").concat(encodeURI(n.message))).then(function(){var e=Object(u.a)(l.a.mark((function e(t){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("failure"!==t.data.result.status){e.next=2;break}throw new Error;case 2:return e.next=4,s();case 4:r.values.message="";case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()).catch((function(e){}));case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),validate:function(e){var t={};return e.message.length>140&&(t.message="Message trop long"),t}});return Object(n.jsx)("div",{className:"typingBar",children:Object(n.jsxs)("form",{onSubmit:r.handleSubmit,children:[r.touched.message&&r.errors.message&&Object(n.jsx)("div",{className:"errorMessage",children:r.errors.message}),Object(n.jsxs)("div",{className:"input-icons",children:[Object(n.jsx)(V.a,{className:"searchIcon",icon:P.a}),Object(n.jsx)("input",{type:"text",className:r.errors.message?"redMessage":"inputMessage",id:"message",name:"message",placeholder:"Votre message...",onChange:r.handleChange,onBlur:r.handleBlur,value:r.values.message})]})]})})},_=a(176);var q=function(e){var t=e.token,a=e.username,r=e.id,c=Object(s.useState)([]),o=Object(i.a)(c,2),j=o[0],d=o[1],h=Object(s.useState)(12e5),m=Object(i.a)(h,1)[0],p=Object(s.useState)(!1),O=Object(i.a)(p,2),v=O[0],x=O[1],g=Object(s.useState)(!1),f=Object(i.a)(g,2),w=f[0],k=f[1],N=null,S=Object(s.useRef)(null),B=function(){var e=Object(u.a)(l.a.mark((function e(){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,b.a.get("".concat("https://greenvelvet.alwaysdata.net/kwick/api/","talk/list/").concat(t,"/0")).then((function(e){if("failure"===e.data.result.status)throw new Error;d(e.data.result.talk),I()})).catch((function(e){}));case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),I=function(){S.current.scrollIntoView({behavior:"smooth"})};Object(s.useEffect)((function(){B()}),[]);var D=function(){x(!1)};return Object(n.jsxs)(n.Fragment,{children:[Object(n.jsx)(A.a,{ref:function(e){N=e},element:document,onActive:D,onIdle:function(){v?k(!0):(k(!1),N.reset(),x(!0))},onAction:D,debounce:250,timeout:m}),Object(n.jsx)(T,{open:w,setOpen:k}),Object(n.jsxs)("main",{children:[Object(n.jsx)(y,{token:t,setMessages:d,scrollToBottom:I}),Object(n.jsxs)("section",{className:"sectionMessages",children:[Object(n.jsxs)("div",{className:"messagesContainer",children:[j&&j.length?j.map((function(e,t){return e.user_name!==a?Object(n.jsx)(M,{message:e},t):Object(n.jsx)(C,{message:e},t)})):Object(n.jsx)(_.a,{variant:"outlined",severity:"error",children:"Aucun messages !"}),Object(n.jsx)("div",{ref:S})]}),Object(n.jsx)(J,{fetchData:B,token:t,id:r})]})]})]})},z=(a(83),Object(s.createContext)());function Z(){return Object(s.useContext)(z)}var $=function(e){var t={};return e.name||(t.name="Nom requis"),e.email?/^[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,4}$/i.test(e.email)||(t.email="Format d'email invalide"):t.email="Email requis",e.password||(t.password="Mot de passe requis"),t};var Q=function(){var e=Object(s.useState)(!1),t=Object(i.a)(e,2),a=t[0],r=t[1],c=Z().setAuthTokens,o=Object(j.g)(),h=Object(R.a)({initialValues:{name:"",email:"",password:""},onSubmit:function(){var e=Object(u.a)(l.a.mark((function e(t){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,b.a.get("".concat("https://greenvelvet.alwaysdata.net/kwick/api/","signup/").concat(t.name,"/").concat(t.password)).then((function(e){if("failure"===e.data.result.status)throw r(!0),new Error;c(e.data.result),o.push("/")})).catch((function(e){r(!0)}));case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),validate:$});return Object(n.jsxs)("form",{className:"formSignup",onSubmit:h.handleSubmit,children:[a&&Object(n.jsx)(_.a,{severity:"error",children:"Erreur de conexion. Veuillez choisir un autre nom et mot de passe"}),Object(n.jsx)("h2",{className:"titleSignup",children:"S'inscrire"}),Object(n.jsxs)("div",{className:"divInputSingup",children:[Object(n.jsx)("input",{id:"name",name:"name",type:"text",placeholder:"Nom",className:"inputSignup",onChange:h.handleChange,onBlur:h.handleBlur,value:h.values.name}),h.touched.name&&h.errors.name&&Object(n.jsx)(_.a,{severity:"error",children:h.errors.name})]}),Object(n.jsxs)("div",{className:"divInputSingup",children:[Object(n.jsx)("input",{id:"email",name:"email",type:"text",placeholder:"Email",className:"inputSignup",onChange:h.handleChange,onBlur:h.handleBlur,value:h.values.email}),h.touched.email&&h.errors.email&&Object(n.jsx)(_.a,{severity:"error",children:h.errors.email})]}),Object(n.jsxs)("div",{className:"divInputSingup",children:[Object(n.jsx)("input",{id:"password",name:"password",type:"password",placeholder:"Mot de passe",className:"inputSignup",onChange:h.handleChange,onBlur:h.handleBlur,value:h.values.password}),h.touched.password&&h.errors.password&&Object(n.jsx)(_.a,{severity:"error",children:h.errors.password})]}),Object(n.jsx)("p",{children:Object(n.jsx)("input",{type:"submit",value:"Cr\xe9er mon compte",id:"submit"})}),Object(n.jsx)("p",{children:Object(n.jsx)(d.b,{to:"/login",children:"J'ai d\xe9j\xe0 un compte"})})]})};var U=function(e){var t=e.component,a=Object(O.a)(e,["component"]),s=Z().authTokens;return Object(n.jsx)(j.b,Object(p.a)(Object(p.a)({},a),{},{render:function(e){return s?Object(n.jsx)(t,Object(p.a)({},e)):Object(n.jsx)(j.a,{to:"/login"})}}))},G=function(e){var t={};return e.name||(t.name="Nom requis"),e.password||(t.password="Mot de passe requis"),t};var H=function(){var e=Object(s.useState)(!1),t=Object(i.a)(e,2),a=t[0],r=t[1],c=Z().setAuthTokens,o=Object(j.g)(),h=Object(R.a)({initialValues:{name:"",email:"",password:""},onSubmit:function(){var e=Object(u.a)(l.a.mark((function e(t){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,b.a.get("".concat("https://greenvelvet.alwaysdata.net/kwick/api/","login/").concat(t.name,"/").concat(t.password)).then((function(e){if("failure"===e.data.result.status)throw r(!0),new Error;c(e.data.result),o.push("/")})).catch((function(e){r(!0)}));case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),validate:G});return Object(n.jsxs)("form",{className:"formSignup",onSubmit:h.handleSubmit,children:[a&&Object(n.jsx)(_.a,{severity:"error",children:"Erreur de conexion. Mauvais nom ou mot de passe"}),Object(n.jsx)("h2",{className:"titleSignup",children:"Se connecter"}),Object(n.jsxs)("div",{className:"divInputSingup",children:[Object(n.jsx)("input",{id:"name",name:"name",type:"text",placeholder:"Nom",className:"inputSignup",onChange:h.handleChange,onBlur:h.handleBlur,value:h.values.name}),h.touched.name&&h.errors.name&&Object(n.jsx)(_.a,{severity:"error",children:h.errors.name})]}),Object(n.jsxs)("div",{className:"divInputSingup",children:[Object(n.jsx)("input",{id:"password",name:"password",type:"password",placeholder:"Mot de passe",className:"inputSignup",onChange:h.handleChange,onBlur:h.handleBlur,value:h.values.password}),h.touched.password&&h.errors.password&&Object(n.jsx)(_.a,{severity:"error",children:h.errors.password})]}),Object(n.jsx)("p",{children:Object(n.jsx)("input",{type:"submit",value:"Me connecter",id:"submit"})}),Object(n.jsx)("p",{children:Object(n.jsx)(d.b,{to:"/signup",children:"Je n'ai pas de compte"})})]})};var K=function(){var e,t,a;if(localStorage.getItem("myAuthInLocalStorage")){var r=JSON.parse(localStorage.getItem("myAuthInLocalStorage"));e=r.token,a=r.username,t=r.id}var c=Object(s.useState)(e),o=Object(i.a)(c,2),l=o[0],u=o[1];return Object(n.jsx)(z.Provider,{value:{authTokens:l,setAuthTokens:function(e){var t={token:e.token,id:e.id,username:e.message.split(" ").splice(-1).toString()};localStorage.setItem("myAuthInLocalStorage",JSON.stringify(t)),u(e)}},children:Object(n.jsx)(d.a,{children:Object(n.jsxs)("div",{className:"App",children:[Object(n.jsx)(m,{token:e,id:t}),Object(n.jsxs)(j.d,{children:[Object(n.jsx)(U,{exact:!0,path:"/",component:l?function(){return Object(n.jsx)(q,{token:e,username:a,id:t})}:H}),Object(n.jsx)(v,{path:"/signup",component:Q}),Object(n.jsx)(v,{path:"/login",component:H}),Object(n.jsx)(v,{path:"/:id",component:H})]})]})})})},W=function(e){e&&e instanceof Function&&a.e(3).then(a.bind(null,182)).then((function(t){var a=t.getCLS,n=t.getFID,s=t.getFCP,r=t.getLCP,c=t.getTTFB;a(e),n(e),s(e),r(e),c(e)}))};c.a.render(Object(n.jsx)(K,{}),document.getElementById("root")),W()},53:function(e,t,a){},83:function(e,t,a){}},[[128,1,2]]]);
//# sourceMappingURL=main.308b2f77.chunk.js.map